# Deploy Tool Project Configuration
version: "1.0"

project:
  name: "${PROJECT_NAME}"
  root: "${PROJECT_ROOT}"
  description: "${PROJECT_DESCRIPTION}"

# Component definitions
components:
  model:
    path: ./models
    description: "Machine learning models"

  config:
    path: ./configs
    description: "Configuration files"

  runtime:
    path: ./runtime
    description: "Runtime environment"

# Packaging defaults
packaging:
  compression:
    algorithm: gzip  # Options: gzip, bzip2, xz, lz4
    level: 6        # 1-9, higher = better compression

  exclude_patterns:
    - "*.log"
    - "__pycache__/"
    - ".DS_Store"
    - ".git/"
    - "*.tmp"
    - "*.cache"

# Publish configuration
publish:
  # Default targets for publish operations
  default_targets:
    - local-primary

  # Available publish targets
  targets:
    local-primary:
      type: filesystem
      path: /data/packages
      description: "Primary local storage"

    local-backup:
      type: filesystem
      path: /backup/packages
      description: "Backup local storage"

    bos-beijing:
      type: bos
      endpoint: bj.bcebos.com
      bucket: ml-artifacts
      access_key: ${BOS_AK}
      secret_key: ${BOS_SK}
      description: "Beijing BOS storage"

    s3-us-west:
      type: s3
      region: us-west-2
      bucket: ml-artifacts
      access_key: ${AWS_ACCESS_KEY_ID}
      secret_key: ${AWS_SECRET_ACCESS_KEY}
      description: "AWS S3 storage"

# Deployment configuration
deploy:
  # Deployment root directory
  root: ${DEPLOY_ROOT:/opt/deployments}

  # Source priority for deployment
  source_priority:
    - local-primary
    - local-backup
    - bos-beijing
    - s3-us-west

  # Failover configuration
  failover:
    enabled: true
    retry_count: 3
    retry_delay: 5  # seconds
    backoff_multiplier: 2  # exponential backoff

  # Version retention policy
  retention:
    keep_versions: 5  # Keep last N versions
    keep_days: 30     # Keep versions newer than N days
    keep_tagged: true # Always keep tagged versions

  # Custom link mappings (optional)
  custom_links:
    # Application expected path -> Deployment link path
    # /app/models: /opt/deployments/links/model
    # /app/configs: /opt/deployments/links/config

# Cache configuration
cache:
  enabled: true
  directory: ${DEPLOY_TOOL_CACHE:.deploy-tool-cache}
  max_size: 10GB
  ttl: 7d  # Cache time-to-live

# Hooks (optional)
hooks:
  pre_pack: []      # Commands to run before packaging
  post_pack: []     # Commands to run after packaging
  pre_publish: []   # Commands to run before publishing
  post_publish: []  # Commands to run after publishing
  pre_deploy: []    # Commands to run before deployment
  post_deploy: []   # Commands to run after deployment

# Logging
logging:
  level: ${DEPLOY_TOOL_LOG_LEVEL:INFO}
  file: ${DEPLOY_TOOL_LOG_FILE:}
  format: "%(asctime)s [%(levelname)s] %(message)s"